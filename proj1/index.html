<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project 1: Images of the Russian Empire</title>
  <style>
    :root {
      --sidebar-w: 200px;
      --border: #ddd;
      --text: #000;
      --muted: #555;
      --bg: #fff;
      --bg-soft: #fafafa;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
      display: flex;
    }

    /* Sidebar (matches proj0) */
    .sidebar {
      width: var(--sidebar-w);
      background: var(--bg-soft);
      border-right: 1px solid var(--border);
      padding: 20px 0;
      flex-shrink: 0;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
    }
    .brand { font-size: 16px; font-weight: 700; padding: 0 20px 8px; }
    .nav { list-style: none; margin: 0; padding: 8px 0; }
    .nav a {
      display: block;
      padding: 10px 20px;
      text-decoration: none;
      color: #000;
    }
    .nav a:hover,
    .nav a.active {
      background: #000;
      color: #fff;
    }

    /* Main (matches proj0) */
    .container {
      margin-left: var(--sidebar-w);
      padding: 40px;
      max-width: 1000px;
      width: calc(100% - var(--sidebar-w));
      margin-right: auto;
    }
    h1 { margin-top: 0; text-align: center; }
    hr { border: none; border-top: 1px solid var(--border); margin: 20px 0; }

    /* Section headings (left rule like proj0) */
    .section-title {
      margin-top: 30px;
      border-left: 4px solid #000;
      padding-left: 10px;
      font-weight: bold;
    }

    p { margin: 12px 0; font-size: 16px; }

    /* Figure grid (consistent with proj0) */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin: 18px 0 8px;
    }
    figure { margin: 0; text-align: center; }
    figure img {
      max-width: 100%;
      height: auto;
      border: 1px solid var(--border);
      border-radius: 6px;
      max-height: 300px;   /* keep visuals tidy like proj0 */
      object-fit: cover;
    }
    figcaption { color: var(--muted); font-size: 14px; margin-top: 6px; }

    .footer {
      margin-top: 40px;
      padding-top: 18px;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 14px;
      text-align: center;
    }

    /* Responsive (matches proj0) */
    @media (max-width: 680px) {
      :root { --sidebar-w: 0px; }
      .sidebar { display: none; }
      .container { margin-left: 0; padding: 18px 16px; max-width: 100%; width: 100%; }
      figure img { max-height: 200px; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">Wesley Lin</div>
    <nav>
      <ul class="nav">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../proj0/index.html">Project 0</a></li>
        <li><a class="active" href="./index.html">Project 1</a></li>
        <li><a href="../proj2/index.html">Project 2</a></li>
        <li><a href="../proj3/index.html">Project 3</a></li>
        <li><a href="../proj4/index.html">Project 4</a></li>
        <li><a href="../proj5/index.html">Project 5</a></li>
      </ul>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="container">
    <h1>Project 1: Images of the Russian Empire</h1>
    <p class="subtitle text-center">Colorizing the Prokudin-Gorskii photo collection</p>
    <hr />

    <section>
      <h2 class="section-title">Overview</h2>
      <p>
        This project applies computer vision techniques to colorize early Prokudin–Gorskii glass plate photographs. 
        Each scene was captured as three vertically stacked grayscale images (B, G, R channels). I separate the channels 
        and align them to reconstruct full-color images, and I explore how a pyramid-based alignment strategy improves results 
        on larger and finer images.
      </p>
    </section>

    <section>
      <h2 class="section-title">Problem</h2>
      <p>
        Given a single grayscale plate with three stacked exposures, the goal is to align the channels so that corresponding scene features 
        (edges, corners, textures) overlap correctly. Misalignment produces color fringing, so the task is to find integer (or subpixel) 
        shifts per channel that minimize this error.
      </p>

      <div class="grid">
        <figure>
          <img src="./media/plate_negative.png" alt="plate_negative">
          <figcaption>
            <div class="offset">A preprocessed glass plate negative of the Cathedral.</div>
          </figcaption>
        </figure>
      </div>
    </section>

    <section>
      <h2 class="section-title">Part 1: Naive Approach – Single-Scale Alignment</h2>
      <p>
        My initial approach used an exhaustive single-scale alignment. I read each image, converted it to floating point, 
        split it into Blue, Green, and Red plates, and used a normalized cross-correlation (NCC) similarity metric to align 
        the three images by selecting the shift with the highest NCC score. 

        My iterative NCC search uses two nested loops over a window of ±15 pixels to test every integer shift in x and y and 
        choose the best alignment. To improve robustness, I compute NCC only on the central region by cropping 33% from each border. 
        This ensures the score is dominated by the main subject rather than frames or degraded edges. 
        I first tried a 10% crop but found that 33% produced better results. After NCC alignment, I post-process by trimming an additional 
        3% from the borders to suppress wraparound and scanning artifacts, producing cleaner final images. This exhaustive search 
        works well for smaller JPGs, but processing slows dramatically on larger TIF files.
      </p>

      <div class="grid">
        <figure>
          <img src="./media/comparison.png" alt="comparison">
          <figcaption>
            <div class="offset">A comparison before and after NCC alignment on a smaller Emir portrait.</div>
          </figcaption>
        </figure>
      </div>

    </section>

    <section>
      <h2 class="section-title">Part 2: Improved Approach – Pyramid Image Alignment:</h2>
      <p>
        To optimize alignment for larger, higher-resolution TIF files, I extend the NCC approach with an image pyramid that builds on the basic algorithm. 
        I recursively downsample the reference and target images by a factor of two (up to eight levels) until they are small enough for an exhaustive search. 
        At the coarsest level, I run the NCC search with a window size of 15 to obtain a coarse shift. Decreasing the window size increases speed at some cost to accuracy. 
        After trying window sizes from 18 down to 12, I found 15 to be a good balance. The coarse shift estimate is then doubled as I move up each level of the pyramid, 
        and at each finer level I refine the alignment within a smaller local window of 6 pixels. 

        The image pyramid approach successfully aligned all images except emir.tif. That failure likely stems from the stronger exposure and contrast differences across 
        the channels that weaken raw NCC. An even more improved approach would be to use edge detection with gradients, which is something I am excited to explore next. 

        Below are my results on the 14 required images, along with 3 additional examples of my choice from Prokudin–Gorskii’s collection.
      </p>
    </section>

<section>
  <h2 class="section-title">Gallery</h2>
  <div class="grid">
    <figure>
      <img src="./media/cathedral_aligned.png" alt="Cathedral">
      <figcaption>
        <div><strong>Cathedral</strong></div>
        <div class="offset">Green offset: (5, 2), Red offset: (12, 3)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/church_aligned.png" alt="Church">
      <figcaption>
        <div><strong>Church</strong></div>
        <div class="offset">Green offset: (25, 4), Red offset: (58, -4)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/emir_aligned.png" alt="Emir">
      <figcaption>
        <div><strong>Emir</strong></div>
        <div class="offset">Green offset: (48, 24), Red offset: (-121, -67)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/harvesters_aligned.png" alt="Harvesters">
      <figcaption>
        <div><strong>Harvesters</strong></div>
        <div class="offset">Green offset: (59, 17), Red offset: (123, 15)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/icon_aligned.png" alt="Icon">
      <figcaption>
        <div><strong>Icon</strong></div>
        <div class="offset">Green offset: (41, 18), Red offset: (90, 23)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/italil_aligned.png" alt="Italil">
      <figcaption>
        <div><strong>Italil</strong></div>
        <div class="offset">Green offset: (37, 21), Red offset: (76, 36)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/lastochikino_aligned.png" alt="Lastochkino">
      <figcaption>
        <div><strong>Lastochkino</strong></div>
        <div class="offset">Green offset: (-3, -2), Red offset: (75, -8)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/lugano_aligned.png" alt="Lugano">
      <figcaption>
        <div><strong>Lugano</strong></div>
        <div class="offset">Green offset: (39, -15), Red offset: (92, -28)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/melons_aligned.png" alt="Melons">
      <figcaption>
        <div><strong>Melons</strong></div>
        <div class="offset">Green offset: (83, 10), Red offset: (170, 13)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/monastery_aligned.png" alt="Monastery">
      <figcaption>
        <div><strong>Monastery</strong></div>
        <div class="offset">Green offset: (-3, 2), Red offset: (3, 2)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/self_portrait_aligned.png" alt="Self Portrait">
      <figcaption>
        <div><strong>Self Portrait</strong></div>
        <div class="offset">Green offset: (77, 29), Red offset: (170, 36)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/siren_aligned.png" alt="Siren">
      <figcaption>
        <div><strong>Siren</strong></div>
        <div class="offset">Green offset: (49, -5), Red offset: (96, -23)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/three_generations_aligned.png" alt="Three Generations">
      <figcaption>
        <div><strong>Three Generations</strong></div>
        <div class="offset">Green offset: (49, 17), Red offset: (109, 14)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/tobolsk_aligned.png" alt="Tobolsk">
      <figcaption>
        <div><strong>Tobolsk</strong></div>
        <div class="offset">Green offset: (3, 3), Red offset: (7, 3)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/krym_aligned.png" alt="Krym">
      <figcaption>
        <div><strong>Krym</strong></div>
        <div class="offset">Green offset: (33, -11), Red offset: (140, -28)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/tsentr_aligned.png" alt="Tsentr">
      <figcaption>
        <div><strong>Tsentr</strong></div>
        <div class="offset">Green offset: (36, 20), Red offset: (88, 41)</div>
      </figcaption>
    </figure>

    <figure>
      <img src="./media/mozhaiskii_aligned.png" alt="Mozhaiskii">
      <figcaption>
        <div><strong>Mozhaiskii</strong></div>
        <div class="offset">Green offset: (40, 15), Red offset: (91, 25)</div>
      </figcaption>
    </figure>
  </div>
</section>

    <div class="footer">© 2025 Wesley Lin</div>
  </main>
</body>
</html>
